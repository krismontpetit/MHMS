###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.51.2.50607/W32 for MSP430       19/Apr/2013  11:09:23 #
# Copyright 1996-2012 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Components\osal\mcu\msp430\MSP430FlashUtil.c           #
#    Command line  =  -f C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2. #
#                     5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\zap.c #
#                     fg (-DTVSA_DEVICE_ID=0x0016 -DZAP_PHY_SPI=1             #
#                     -DZAP_PHY_UART=!ZAP_PHY_SPI -DZAP_PHY_RESET_ZNP=TRUE    #
#                     -DZAP_ZNP_MT=FALSE -DZAP_APP_MSG=FALSE                  #
#                     -DZAP_SBL_PROXY=FALSE -DZAP_AUTO_CFG=TRUE               #
#                     -DZAP_AUTO_START=TRUE -DZAP_NV_RESTORE=FALSE            #
#                     -DLCD_SUPPORTED -DZAP_AF_DATA_REQ_FRAG=FALSE            #
#                     -DZAP_AF_DATA_REQ_AREQ=!ZAP_AF_DATA_REQ_FRAG            #
#                     -DZAP_ZDO_STARTUP_AREQ=TRUE -DZAP_AF_FUNC               #
#                     -DZAP_SAPI_FUNC -DZAP_SYS_FUNC -DZAP_UTIL_FUNC          #
#                     -DZAP_ZDO_FUNC -DSECURE=0 -DZG_SECURE_DYNAMIC=0         #
#                     "-DDEFAULT_CHANLIST=(uint32)0x00000800"                 #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DPOLL_RATE=1000           #
#                     -DNWK_START_DELAY=100 -DMAX_BINDING_CLUSTER_IDS=4)      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Components\osal\mcu\msp430\MSP430FlashUtil.c -D        #
#                     ZAP_DEVICETYPE=ZG_DEVICETYPE_COORDINATOR -D             #
#                     TVSA_DEVICE_ID=0x0016 -D TVSA_DONGLE=1 -D HAL_UART=1    #
#                     -lC "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP              #
#                     Coordinator\List\" -lA "C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\ZAP Coordinator\List\" --remarks --diag_suppress     #
#                     Pe001,Pe193,Pe236,Pe826 -o                              #
#                     "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5. #
#                     1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP                  #
#                     Coordinator\Obj\" --debug -D__MSP430F5438A__ -e         #
#                     --double=32 --clib -I C:\Users\student\Documents\GitHub #
#                     \MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438 #
#                     \ -I C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\Source\ -I    #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\ -I      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\target\MSP5438ZAP\ -I                          #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\include\ -I C:\Users\student\Documents\GitHub\ #
#                     MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ #
#                     ..\..\..\..\..\Components\mac\include\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\mt\ -I C:\Users\student\Documents\GitHub\MHMS\ZAP- #
#                     MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\ #
#                     ..\..\Components\osal\include\ -I                       #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\osal\mcu\msp430\ -I C:\Users\student\Documents\Git #
#                     Hub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5 #
#                     438\..\..\..\..\..\Components\services\saddr\ -I        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\services\sdata\ -I C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\..\..\..\..\..\Components\stack\af\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\nwk\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sapi\ -I                  #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\sec\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sys\ -I                   #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\zdo\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\zmac\ -I                        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\zmac\f8w\ --core=430X --data_model=small -Ohz      #
#                     --multiplier=32 --multiplier_location=4C0               #
#                     --require_prototypes --hw_workaround=CPU40              #
#                     --hw_workaround=CPU42                                   #
#    List file     =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\List\MSP430FlashUtil.lst                    #
#    Object file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\Obj\MSP430FlashUtil.r43                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1\Components\osal\mcu\msp430\MSP430FlashUtil.c
      1          /**************************************************************************************************
      2            Filename:       MSP430FlashUtil.c
      3            Revised:        $Date: 2008-07-14 13:59:17 -0700 (Mon, 14 Jul 2008) $
      4            Revision:       $Revision: 17524 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          //****************************************************************************
     41          //  MSP-FET430P140 Demo - Flash In-System Programming, Copy SegA to SegB
     42          //
     43          //  Description: This program first erases flash seg A, then it increments all
     44          //  values in seg A, then it erases seg B, then  copies seg A to seg B.
     45          //  Assumed MCLK 550kHz - 900kHz.
     46          //  //* Set Breakpoint on NOP in the Mainloop to avoid Stressing Flash *//
     47          //
     48          //               MSP430F149
     49          //            -----------------
     50          //        /|\|              XIN|-
     51          //         | |                 |
     52          //         --|RST          XOUT|-
     53          //           |                 |
     54          //
     55          //  Texas Instruments Inc.
     56          //  Feb 2005
     57          //  Built with IAR Embedded Workbench Version: 3.21A
     58          //******************************************************************************
     59          
     60          #include "hal_board_cfg.h"

   \                                 In  segment DATA16_AN, at 0x140
   \   union <unnamed> _A_FCTL1_L
   \                     _A_FCTL1_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x144
   \   union <unnamed> _A_FCTL3_L
   \                     _A_FCTL3_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x15c
   \   union <unnamed> _A_WDTCTL_L
   \                     _A_WDTCTL_L:
   \   000000                DS8 2
     61          #include "hal_types.h"
     62          #include "MSP430FlashUtil.h"
     63          
     64          #define STATIC  static
     65          

   \                                 In  segment DATA16_Z, align 1, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     66          STATIC uint8 s_savWDT;
   \                     s_savWDT:
   \   000000                DS8 1
     67          

   \                                 In  segment DATA16_Z, align 2, align-sorted
   \   000000                REQUIRE ?cstart_init_zero
     68          STATIC halIntState_t fuIntState;
   \                     fuIntState:
   \   000000                DS8 2
     69          
     70          // Function prototypes
     71          STATIC void initFlash(void);
     72          STATIC void doneFlash(void);
     73          

   \                                 In  segment CODE, align 2
     74          STATIC void initFlash(void)
   \                     initFlash:
     75          {
     76            HAL_ENTER_CRITICAL_SECTION( fuIntState );  // Hold off interrupts.
   \   000000   0F42         MOV.W   SR, R15
   \   000002   824F....     MOV.W   R15, &fuIntState
   \   000006   32C2         dint
   \   000008   0343         nop
     77          
     78            s_savWDT = WDTCTL & 0xFF;
   \   00000A   1E425C01     MOV.W   &0x15c, R14
   \   00000E   C24E....     MOV.B   R14, &s_savWDT
     79          
     80            WDTCTL = WDTPW + WDTHOLD;                 // Stop watchdog timer
   \   000012   B240805A5C01 MOV.W   #0x5a80, &0x15c
     81          
     82          #if defined FCTL2
     83            FCTL2 = FWKEY + FSSEL_1 + FN4 + FN3;  // Flash Timing Generator as MCLK/24 -> 333 kHz.
     84          #endif
     85          
     86          #if defined HAL_BOARD_F5438
     87            if (FCTL3 & LOCKA)
   \   000018   B2B040004401 BIT.W   #0x40, &0x144
   \   00001E   0328         JNC     ??initFlash_0
     88            {
     89              FCTL3 = FWKEY + LOCKA;  // Clear the user info pages lock for writing the IEEE.
   \   000020   B24040A54401 MOV.W   #0xa540, &0x144
     90            }
     91          #endif
     92          }
   \                     ??initFlash_0:
   \   000026   1001         RETA
   \   000028                REQUIRE _A_WDTCTL_L
   \   000028                REQUIRE _A_FCTL3_L
     93          

   \                                 In  segment CODE, align 2
     94          STATIC void doneFlash()
   \                     doneFlash:
     95          {
     96            // restore WDT
     97            WDTCTL = WDTPW + s_savWDT;
   \   000000   5F42....     MOV.B   &s_savWDT, R15
   \   000004   3F50005A     ADD.W   #0x5a00, R15
   \   000008   824F5C01     MOV.W   R15, &0x15c
     98          
     99            HAL_EXIT_CRITICAL_SECTION( fuIntState );   // Re-enable interrupts.
   \   00000C   1242....     MOV.W   &fuIntState, SR
    100          
    101            return;
   \   000010   1001         RETA
   \   000012                REQUIRE _A_WDTCTL_L
    102          }
    103          

   \                                 In  segment CODE, align 2
    104          void flashErasePage(uint8 *addr)
   \                     flashErasePage:
    105          {
    106            initFlash();
   \   000000   ........     CALLA   #initFlash
    107          
    108            FCTL1 = FWKEY + ERASE;               // Set Erase bit
   \   000004   B24002A54001 MOV.W   #0xa502, &0x140
    109            FCTL3 = FWKEY;                       // Clear Lock bit
   \   00000A   B24000A54401 MOV.W   #0xa500, &0x144
    110            *addr = 0;                           // Dummy write to erase Flash segment
   \   000010   CC430000     MOV.B   #0x0, 0(R12)
    111            FCTL1 = FWKEY;                       // Clear ERASE bit
   \   000014   ........     CALLA   #?Subroutine0
    112            FCTL3 = FWKEY + LOCK;                // Set LOCK bit
    113          
    114            doneFlash();
   \                     ??CrossCallReturnLabel_1:
   \   000018   ........     BRA     #doneFlash
   \   00001C                REQUIRE _A_FCTL1_L
   \   00001C                REQUIRE _A_FCTL3_L
    115            return;
    116          }

   \                                 In  segment CODE, align 2
   \                     ?Subroutine0:
   \   000000   B24000A54001 MOV.W   #0xa500, &0x140
   \   000006   B24010A54401 MOV.W   #0xa510, &0x144
   \   00000C   1001         RETA
    117          

   \                                 In  segment CODE, align 2
    118          void flashWrite( uint8 *addr, uint16 len, uint8 *buf )
   \                     flashWrite:
    119          {
   \   000000   0A12         PUSH.W  R10
   \   000002   0A4E         MOV.W   R14, R10
    120            initFlash();
   \   000004   ........     CALLA   #initFlash
    121          
    122            FCTL3 = FWKEY;                // Clear Lock bit
   \   000008   B24000A54401 MOV.W   #0xa500, &0x144
    123            FCTL1 = FWKEY + WRT;          // Set WRT bit for write operation
   \   00000E   B24040A54001 MOV.W   #0xa540, &0x140
   \   000014   033C         JMP     ??flashWrite_1
    124          
    125            while ( len-- )
    126            {
    127              *addr++ = *buf++;            // Write value to flash
   \                     ??flashWrite_0:
   \   000016   FC4A0000     MOV.B   @R10+, 0(R12)
   \   00001A   1C53         ADD.W   #0x1, R12
    128            }
   \                     ??flashWrite_1:
   \   00001C   0F4D         MOV.W   R13, R15
   \   00001E   3D53         ADD.W   #0xffff, R13
   \   000020   0F93         CMP.W   #0x0, R15
   \   000022   F923         JNE     ??flashWrite_0
    129          
    130            FCTL1 = FWKEY;                // Clear WRT bit
   \   000024   ........     CALLA   #?Subroutine0
    131            FCTL3 = FWKEY + LOCK;         // Set LOCK bit
    132          
    133            doneFlash();
   \                     ??CrossCallReturnLabel_0:
   \   000028   ........     CALLA   #doneFlash
    134          }
   \   00002C   3A41         POP.W   R10
   \   00002E   1001         RETA
   \   000030                REQUIRE _A_FCTL3_L
   \   000030                REQUIRE _A_FCTL1_L
    135          
    136          /*********************************************************************
    137          *********************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
       4  doneFlash
       4  flashErasePage
            4 -> doneFlash
            4 -> initFlash
       6  flashWrite
            6 -> doneFlash
            6 -> initFlash
       4  initFlash


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      14  ?Subroutine0
       2  _A_FCTL1_L
       2  _A_FCTL3_L
       2  _A_WDTCTL_L
      18  doneFlash
      28  flashErasePage
      48  flashWrite
       2  fuIntState
      40  initFlash
       1  s_savWDT

 
 148 bytes in segment CODE
   6 bytes in segment DATA16_AN
   3 bytes in segment DATA16_Z
 
 148 bytes of CODE memory
   3 bytes of DATA memory (+ 6 bytes shared)

Errors: none
Warnings: none
