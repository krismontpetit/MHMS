###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.51.2.50607/W32 for MSP430       04/Apr/2013  15:23:18 #
# Copyright 1996-2012 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Components\hal\target\MSP5438ZAP\hal_spi.c             #
#    Command line  =  -f C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2. #
#                     5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\zap.c #
#                     fg (-DZAP_PHY_SPI=1 -DZAP_PHY_UART=!ZAP_PHY_SPI         #
#                     -DZAP_PHY_RESET_ZNP=TRUE -DZAP_ZNP_MT=FALSE             #
#                     -DZAP_APP_MSG=FALSE -DZAP_SBL_PROXY=FALSE               #
#                     -DZAP_AUTO_CFG=TRUE -DZAP_AUTO_START=TRUE               #
#                     -DZAP_NV_RESTORE=FALSE -DLCD_SUPPORTED                  #
#                     -DZAP_AF_DATA_REQ_FRAG=FALSE                            #
#                     -DZAP_AF_DATA_REQ_AREQ=!ZAP_AF_DATA_REQ_FRAG            #
#                     -DZAP_ZDO_STARTUP_AREQ=TRUE -DZAP_AF_FUNC               #
#                     -DZAP_SAPI_FUNC -DZAP_SYS_FUNC -DZAP_UTIL_FUNC          #
#                     -DZAP_ZDO_FUNC -DSECURE=0 -DZG_SECURE_DYNAMIC=0         #
#                     "-DDEFAULT_CHANLIST=(uint32)0x00000800"                 #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DPOLL_RATE=1000           #
#                     -DNWK_START_DELAY=100 -DMAX_BINDING_CLUSTER_IDS=4)      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Components\hal\target\MSP5438ZAP\hal_spi.c -D          #
#                     ZAP_DEVICETYPE=ZG_DEVICETYPE_COORDINATOR -D             #
#                     TVSA_DEVICE_ID=0x0016 -D TVSA_DONGLE=1 -D HAL_UART=1    #
#                     -lC "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP              #
#                     Coordinator\List\" -lA "C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\ZAP Coordinator\List\" --remarks --diag_suppress     #
#                     Pe001,Pe193,Pe236,Pe826 -o                              #
#                     "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5. #
#                     1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP                  #
#                     Coordinator\Obj\" --debug -D__MSP430F5438__ -e          #
#                     --double=32 --clib -I C:\Users\student\Documents\GitHub #
#                     \MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438 #
#                     \ -I C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\Source\ -I    #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\ -I      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\target\MSP5438ZAP\ -I                          #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\include\ -I C:\Users\student\Documents\GitHub\ #
#                     MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ #
#                     ..\..\..\..\..\Components\mac\include\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\mt\ -I C:\Users\student\Documents\GitHub\MHMS\ZAP- #
#                     MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\ #
#                     ..\..\Components\osal\include\ -I                       #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\osal\mcu\msp430\ -I C:\Users\student\Documents\Git #
#                     Hub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5 #
#                     438\..\..\..\..\..\Components\services\saddr\ -I        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\services\sdata\ -I C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\..\..\..\..\..\Components\stack\af\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\nwk\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sapi\ -I                  #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\sec\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sys\ -I                   #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\zdo\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\zmac\ -I                        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\zmac\f8w\ --core=430X --data_model=small -Ohz      #
#                     --multiplier=32 --multiplier_location=4C0               #
#                     --require_prototypes --hw_workaround=CPU40              #
#                     --hw_workaround=CPU42                                   #
#    List file     =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\List\hal_spi.lst                            #
#    Object file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\Obj\hal_spi.r43                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1\Components\hal\target\MSP5438ZAP\hal_spi.c
      1          /**************************************************************************************************
      2            Filename:       hal_spi.c
      3            Revised:        $Date:$
      4            Revision:       $Revision:$
      5          
      6            Description:    This file contains the interface to the HAL SPI.
      7          
      8          
      9            Copyright 2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /**************************************************************************************************
     41           *                                           INCLUDES
     42           **************************************************************************************************/
     43          
     44          #include  "hal_board.h"

   \                                 In  segment DATA16_AN, at 0x222
   \   union <unnamed> _A_PBOUT_L
   \                     _A_PBOUT_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x224
   \   union <unnamed> _A_PBDIR_L
   \                     _A_PBDIR_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x22a
   \   union <unnamed> _A_PBSEL_L
   \                     _A_PBSEL_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x5e0
   \   union <unnamed> _A_UCB0CTLW0_L
   \                     _A_UCB0CTLW0_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x5e6
   \   union <unnamed> _A_UCB0BRW_L
   \                     _A_UCB0BRW_L:
   \   000000                DS8 2

   \                                 In  segment DATA16_AN, at 0x5ec
   \   unsigned char const volatile UCB0RXBUF
   \                     UCB0RXBUF:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x5ee
   \   unsigned char volatile UCB0TXBUF
   \                     UCB0TXBUF:
   \   000000                DS8 1

   \                                 In  segment DATA16_AN, at 0x5fc
   \   union <unnamed> _A_UCB0ICTL_L
   \                     _A_UCB0ICTL_L:
   \   000000                DS8 2
     45          #include  "hal_defs.h"
     46          #include  "hal_types.h"
     47          #include  "hal_spi.h"
     48          
     49          #if (defined HAL_SPI) && (HAL_SPI == TRUE)
     50          /**************************************************************************************************
     51           *                                            CONSTANTS
     52           **************************************************************************************************/
     53          
     54          /**************************************************************************************************
     55           *                                              MACROS
     56           **************************************************************************************************/
     57          
     58          /**************************************************************************************************
     59           *                                            TYPEDEFS
     60           **************************************************************************************************/
     61          
     62          /**************************************************************************************************
     63           *                                         GLOBAL VARIABLES
     64           **************************************************************************************************/
     65          
     66          /**************************************************************************************************
     67           *                                          FUNCTIONS - API
     68           **************************************************************************************************/
     69          
     70          /**************************************************************************************************
     71           * @fn      HalSpiFlush
     72           *
     73           * @brief   Write a buffer to the SPI.
     74           *
     75           * @param   port - SPI port.
     76           *          len - Number of bytes to flush.
     77           *
     78           * @return  None
     79           **************************************************************************************************/

   \                                 In  segment CODE, align 2
     80          void HalSpiFlush(uint8 port, uint8 len)
   \                     HalSpiFlush:
   \                     ??HalSpiFlush_0:
     81          {
     82            (void)port;
     83          
     84            while (len--)
   \   000000   4E4D         MOV.B   R13, R14
   \   000002   7D53         ADD.B   #0xff, R13
   \   000004   4E93         CMP.B   #0x0, R14
   \   000006   0824         JEQ     ??HalSpiFlush_2
     85            {
     86              HAL_SPI_WRITE_BYTE(0);
   \   000008   D2C3FD05     BIC.B   #0x1, &0x5fd
   \   00000C   C243EE05     MOV.B   #0x0, &0x5ee
     87              HAL_SPI_WAIT_DONE();
   \                     ??HalSpiFlush_1:
   \   000010   D2B3FD05     BIT.B   #0x1, &0x5fd
   \   000014   F52F         JC      ??HalSpiFlush_0
   \   000016   FC3F         JMP     ??HalSpiFlush_1
     88            }
     89          }
   \                     ??HalSpiFlush_2:
   \   000018   1001         RETA
   \   00001A                REQUIRE _A_UCB0ICTL_L
   \   00001A                REQUIRE UCB0TXBUF
     90          
     91          /**************************************************************************************************
     92           * @fn      HalSpiInit
     93           *
     94           * @brief   Initialize SPI Service
     95           *
     96           * @param   None
     97           *
     98           * @return  None
     99           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    100          void HalSpiInit(void)
   \                     HalSpiInit:
    101          {
    102            HAL_SPI_INIT();
   \   000000   F2408100E005 MOV.B   #0x81, &0x5e0
   \   000006   F2406900E105 MOV.B   #0x69, &0x5e1
   \   00000C   F2400600E605 MOV.B   #0x6, &0x5e6
   \   000012   C243E705     MOV.B   #0x0, &0x5e7
   \   000016   F2D00E002A02 BIS.B   #0xe, &0x22a
   \   00001C   D2C32A02     BIC.B   #0x1, &0x22a
   \   000020   D2D32202     BIS.B   #0x1, &0x222
   \   000024   F2D00B002402 BIS.B   #0xb, &0x224
   \   00002A   D2C3E005     BIC.B   #0x1, &0x5e0
    103          }
   \   00002E   1001         RETA
   \   000030                REQUIRE _A_UCB0CTLW0_L
   \   000030                REQUIRE _A_UCB0BRW_L
   \   000030                REQUIRE _A_PBSEL_L
   \   000030                REQUIRE _A_PBOUT_L
   \   000030                REQUIRE _A_PBDIR_L
    104          
    105          /**************************************************************************************************
    106           * @fn      HalSpiPoll
    107           *
    108           * @brief   Poll the SPI.
    109           *
    110           * @param   None
    111           *
    112           * @return  None
    113           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    114          void HalSpiPoll(void)
   \                     HalSpiPoll:
    115          {
    116            extern void zapPhySpiPoll(uint8 port);
    117            zapPhySpiPoll(0);
   \   000000   4C43         MOV.B   #0x0, R12
   \   000002   ........     BRA     #zapPhySpiPoll
    118          }
    119          
    120          /**************************************************************************************************
    121           * @fn      HalSpiWrite
    122           *
    123           * @brief   Write a buffer to the SPI.
    124           *
    125           * @param   port - SPI port.
    126           *          pBuf - Pointer to the buffer that will be written.
    127           *          len - Number of bytes to write/read.
    128           *
    129           * @return  None
    130           **************************************************************************************************/

   \                                 In  segment CODE, align 2
    131          void HalSpiWrite(uint8 port, uint8 *pBuf, uint8 len)
   \                     HalSpiWrite:
    132          {
    133            (void)port;
    134          
    135            HAL_SPI_SS_ON();
   \   000000   D2C32202     BIC.B   #0x1, &0x222
   \   000004   0B3C         JMP     ??HalSpiWrite_2
    136            while (len--)
    137            {
    138              HAL_SPI_WRITE_BYTE(*pBuf);
   \                     ??HalSpiWrite_1:
   \   000006   D2C3FD05     BIC.B   #0x1, &0x5fd
   \   00000A   E24DEE05     MOV.B   @R13, &0x5ee
    139              HAL_SPI_WAIT_DONE();
   \                     ??HalSpiWrite_0:
   \   00000E   D2B3FD05     BIT.B   #0x1, &0x5fd
   \   000012   FD2B         JNC     ??HalSpiWrite_0
    140              *pBuf++ = HAL_SPI_READ_BYTE();
   \   000014   DD42EC050000 MOV.B   &0x5ec, 0(R13)
   \   00001A   1D53         ADD.W   #0x1, R13
    141            }
   \                     ??HalSpiWrite_2:
   \   00001C   4F4E         MOV.B   R14, R15
   \   00001E   7E53         ADD.B   #0xff, R14
   \   000020   4F93         CMP.B   #0x0, R15
   \   000022   F123         JNE     ??HalSpiWrite_1
    142            HAL_SPI_SS_OFF();
   \   000024   D2D32202     BIS.B   #0x1, &0x222
    143          }
   \   000028   1001         RETA
   \   00002A                REQUIRE _A_PBOUT_L
   \   00002A                REQUIRE _A_UCB0ICTL_L
   \   00002A                REQUIRE UCB0TXBUF
   \   00002A                REQUIRE UCB0RXBUF
    144          #endif
    145          
    146          /**************************************************************************************************
    147          **************************************************************************************************/

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
       4  HalSpiFlush
       4  HalSpiInit
       4  HalSpiPoll
            4 -> zapPhySpiPoll
       4  HalSpiWrite


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      26  HalSpiFlush
      48  HalSpiInit
       6  HalSpiPoll
      42  HalSpiWrite
       1  UCB0RXBUF
       1  UCB0TXBUF
       2  _A_PBDIR_L
       2  _A_PBOUT_L
       2  _A_PBSEL_L
       2  _A_UCB0BRW_L
       2  _A_UCB0CTLW0_L
       2  _A_UCB0ICTL_L

 
 122 bytes in segment CODE
  14 bytes in segment DATA16_AN
 
 122 bytes of CODE memory
   0 bytes of DATA memory (+ 14 bytes shared)

Errors: none
Warnings: none
