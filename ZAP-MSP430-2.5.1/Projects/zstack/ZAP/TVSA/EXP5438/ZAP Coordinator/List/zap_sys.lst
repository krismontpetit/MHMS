###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.51.2.50607/W32 for MSP430       19/Apr/2013  11:09:29 #
# Copyright 1996-2012 IAR Systems AB.                                         #
#                                                                             #
#    __rt_version  =  3                                                       #
#    __double_size =  32                                                      #
#    __reg_r4      =  free                                                    #
#    __reg_r5      =  free                                                    #
#    __pic         =  no                                                      #
#    __core        =  430X                                                    #
#    __data_model  =  small                                                   #
#    Source file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\Source\zap_sys.c                   #
#    Command line  =  -f C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2. #
#                     5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\zap.c #
#                     fg (-DTVSA_DEVICE_ID=0x0016 -DZAP_PHY_SPI=1             #
#                     -DZAP_PHY_UART=!ZAP_PHY_SPI -DZAP_PHY_RESET_ZNP=TRUE    #
#                     -DZAP_ZNP_MT=FALSE -DZAP_APP_MSG=FALSE                  #
#                     -DZAP_SBL_PROXY=FALSE -DZAP_AUTO_CFG=TRUE               #
#                     -DZAP_AUTO_START=TRUE -DZAP_NV_RESTORE=FALSE            #
#                     -DLCD_SUPPORTED -DZAP_AF_DATA_REQ_FRAG=FALSE            #
#                     -DZAP_AF_DATA_REQ_AREQ=!ZAP_AF_DATA_REQ_FRAG            #
#                     -DZAP_ZDO_STARTUP_AREQ=TRUE -DZAP_AF_FUNC               #
#                     -DZAP_SAPI_FUNC -DZAP_SYS_FUNC -DZAP_UTIL_FUNC          #
#                     -DZAP_ZDO_FUNC -DSECURE=0 -DZG_SECURE_DYNAMIC=0         #
#                     "-DDEFAULT_CHANLIST=(uint32)0x00000800"                 #
#                     -DZDAPP_CONFIG_PAN_ID=0xFFFF -DPOLL_RATE=1000           #
#                     -DNWK_START_DELAY=100 -DMAX_BINDING_CLUSTER_IDS=4)      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\Source\zap_sys.c -D                #
#                     ZAP_DEVICETYPE=ZG_DEVICETYPE_COORDINATOR -D             #
#                     TVSA_DEVICE_ID=0x0016 -D TVSA_DONGLE=1 -D HAL_UART=1    #
#                     -lC "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP              #
#                     Coordinator\List\" -lA "C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\ZAP Coordinator\List\" --remarks --diag_suppress     #
#                     Pe001,Pe193,Pe236,Pe826 -o                              #
#                     "C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5. #
#                     1\Projects\zstack\ZAP\TVSA\EXP5438\ZAP                  #
#                     Coordinator\Obj\" --debug -D__MSP430F5438A__ -e         #
#                     --double=32 --clib -I C:\Users\student\Documents\GitHub #
#                     \MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438 #
#                     \ -I C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430- #
#                     2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\Source\ -I    #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\Source\ -I      #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\target\MSP5438ZAP\ -I                          #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\hal\include\ -I C:\Users\student\Documents\GitHub\ #
#                     MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\ #
#                     ..\..\..\..\..\Components\mac\include\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\mt\ -I C:\Users\student\Documents\GitHub\MHMS\ZAP- #
#                     MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\ #
#                     ..\..\Components\osal\include\ -I                       #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\osal\mcu\msp430\ -I C:\Users\student\Documents\Git #
#                     Hub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5 #
#                     438\..\..\..\..\..\Components\services\saddr\ -I        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\services\sdata\ -I C:\Users\student\Documents\GitH #
#                     ub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP54 #
#                     38\..\..\..\..\..\Components\stack\af\ -I               #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\nwk\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sapi\ -I                  #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\sec\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\stack\sys\ -I                   #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\stack\zdo\ -I C:\Users\student\Documents\GitHub\MH #
#                     MS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\TVSA\EXP5438\.. #
#                     \..\..\..\..\Components\zmac\ -I                        #
#                     C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\..\..\..\..\..\Compon #
#                     ents\zmac\f8w\ --core=430X --data_model=small -Ohz      #
#                     --multiplier=32 --multiplier_location=4C0               #
#                     --require_prototypes --hw_workaround=CPU40              #
#                     --hw_workaround=CPU42                                   #
#    List file     =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\List\zap_sys.lst                            #
#    Object file   =  C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1 #
#                     \Projects\zstack\ZAP\TVSA\EXP5438\ZAP                   #
#                     Coordinator\Obj\zap_sys.r43                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\student\Documents\GitHub\MHMS\ZAP-MSP430-2.5.1\Projects\zstack\ZAP\Source\zap_sys.c
      1          /**************************************************************************************************
      2              Filename:       zap_sys.c
      3              Revised:        $Date: 2010-12-01 15:31:18 -0800 (Wed, 01 Dec 2010) $
      4              Revision:       $Revision: 24529 $
      5          
      6              Description:
      7          
      8              This file declares the ZNP Application Processor SYS API functions.
      9          
     10          
     11              Copyright 2009-2010 Texas Instruments Incorporated. All rights reserved.
     12          
     13              IMPORTANT: Your use of this Software is limited to those specific rights
     14              granted under the terms of a software license agreement between the user
     15              who downloaded the software, his/her employer (which must be your employer)
     16              and Texas Instruments Incorporated (the "License").  You may not use this
     17              Software unless you agree to abide by the terms of the License. The License
     18              limits your use, and you acknowledge, that the Software may not be modified,
     19              copied or distributed unless embedded on a Texas Instruments microcontroller
     20              or used solely and exclusively in conjunction with a Texas Instruments radio
     21              frequency transceiver, which is integrated into your product.  Other than for
     22              the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     23              works of, modify, distribute, perform, display or sell this Software and/or
     24              its documentation for any purpose.
     25          
     26              YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     27              PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     28              INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     29              NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     30              TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     31              NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     32              LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     33              INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     34              OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     35              OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     36              (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     37          
     38              Should you have any questions regarding your right to use this Software,
     39              contact Texas Instruments Incorporated at www.TI.com.
     40          **************************************************************************************************/
     41          
     42          /* ------------------------------------------------------------------------------------------------
     43           *                                          Includes
     44           * ------------------------------------------------------------------------------------------------
     45           */
     46          
     47          #include "mt.h"
     48          #include "mt_rpc.h"
     49          #include "mt_sys.h"
     50          #include "mt_version.h"
     51          #include "OSAL.h"
     52          #include "zap_app.h"
     53          #include "zap_phy.h"
     54          #include "ZComDef.h"
     55          
     56          #if defined (ZAP_SYS_FUNC)
     57          /* ------------------------------------------------------------------------------------------------
     58           *                                           Constants
     59           * ------------------------------------------------------------------------------------------------
     60           */
     61          
     62          /* ------------------------------------------------------------------------------------------------
     63           *                                           Typedefs
     64           * ------------------------------------------------------------------------------------------------
     65           */
     66          
     67          /* ------------------------------------------------------------------------------------------------
     68           *                                           Macros
     69           * ------------------------------------------------------------------------------------------------
     70           */
     71          
     72          /* ------------------------------------------------------------------------------------------------
     73           *                                           Global Variables
     74           * ------------------------------------------------------------------------------------------------
     75           */
     76          
     77          /* ------------------------------------------------------------------------------------------------
     78           *                                           Local Variables
     79           * ------------------------------------------------------------------------------------------------
     80           */
     81          
     82          /* ------------------------------------------------------------------------------------------------
     83           *                                           Local Functions
     84           * ------------------------------------------------------------------------------------------------
     85           */
     86          
     87          static void zapSysResetInd(uint8 port, uint8 *pBuf);
     88          
     89          /**************************************************************************************************
     90           * @fn          zapSysResponseProcessing
     91           *
     92           * @brief       This function processes the SYS sub-system response from the ZNP.
     93           *
     94           * input parameters
     95           *
     96           * @param       port - Port Id corresponding to the ZNP that sent the message.
     97           * @param       pBuf - A pointer to the RPC response.
     98           *
     99           * output parameters
    100           *
    101           * None.
    102           *
    103           * @return      None.
    104           **************************************************************************************************
    105           */

   \                                 In  segment CODE, align 2
    106          void zapSysProcessIncoming(uint8 port, uint8 *pBuf)
   \                     zapSysProcessIncoming:
    107          {
    108            uint8 cmd1 = pBuf[MT_RPC_POS_CMD1];
    109            pBuf += MT_RPC_FRAME_HDR_SZ;
    110          
    111            switch (cmd1)
   \   000000   FD9080000200 CMP.B   #0x80, 0x2(R13)
   \   000006   0220         JNE     ??zapSysProcessIncoming_0
    112            {
    113            case MT_SYS_RESET_IND:
    114              zapSysResetInd(port, pBuf);
   \   000008   ........     CALLA   #zapGotSync
    115              break;
    116          
    117            case MT_SYS_OSAL_TIMER_EXPIRED:
    118              break;
    119          
    120            default:
    121              break;
    122            }
    123          }
   \                     ??zapSysProcessIncoming_0:
   \   00000C   1001         RETA
    124          
    125          /**************************************************************************************************
    126           * @fn          zapSysStackTune
    127           *
    128           * @brief       This function packs and sends an RPC SYS request.
    129           *
    130           * input parameters
    131           *
    132           * @param       cmd - A valid MT_SYS_STACK_TUNE command from STK_Tune_t.
    133           * @param       req - A buffer containing the contents of the request/response, or NULL.
    134           *
    135           * output parameters
    136           *
    137           * @param       req - The buffer filled with the contents or success of a response.
    138           *
    139           * @return      SUCCESS or FAILURE.
    140           **************************************************************************************************
    141           */

   \                                 In  segment CODE, align 2
    142          uint8 zapSysStackTune(uint8 cmd, uint8 *req)
   \                     zapSysStackTune:
    143          {
   \   000000   0A12         PUSH.W  R10
   \   000002   2183         SUB.W   #0x2, SP
    144            uint8 args[2], rtrn = SUCCESS;
   \   000004   4A43         MOV.B   #0x0, R10
    145          
    146            args[0] = cmd;
   \   000006   C14C0000     MOV.B   R12, 0(SP)
    147            args[1] = 1;
   \   00000A   D1430100     MOV.B   #0x1, 0x1(SP)
    148          
    149            switch (cmd)
   \   00000E   4C83         SUB.B   #0x0, R12
   \   000010   0324         JEQ     ??zapSysStackTune_0
   \   000012   5C83         SUB.B   #0x1, R12
   \   000014   0124         JEQ     ??zapSysStackTune_0
    150            {
    151            case STK_TX_PWR:
    152            case STK_RX_ON_IDLE:
    153              break;
    154          
    155            default:
    156              rtrn = FAILURE;
   \   000016   5A43         MOV.B   #0x1, R10
    157              break;
    158            }
    159          
    160            zapSysReq(MT_SYS_STACK_TUNE, req, args);
   \                     ??zapSysStackTune_0:
   \   000018   0E41         MOV.W   SP, R14
   \   00001A   0E53         ADD.W   #0x0, R14
   \   00001C   7C400F00     MOV.B   #0xf, R12
   \   000020   ........     CALLA   #zapSysReq
    161            return rtrn;
   \   000024   4C4A         MOV.B   R10, R12
   \   000026   2153         ADD.W   #0x2, SP
   \   000028   3A41         POP.W   R10
   \   00002A   1001         RETA
    162          }
    163          
    164          /**************************************************************************************************
    165           * @fn          zapSysReq
    166           *
    167           * @brief       This function packs and sends an RPC SYS request.
    168           *
    169           * input parameters
    170           *
    171           * @param       cmd - A valid SYS command.
    172           * @param       req - A buffer containing the contents of the request/response, or NULL.
    173           * @param       args - Valid argument(s) corresponding to the SYS command.
    174           *
    175           * output parameters
    176           *
    177           * @param       req - The buffer filled with the contents or success of a response.
    178           * @param       args - The buffer filled with the contents or success of a response.
    179           *
    180           * @return      SUCCESS or FAILURE.
    181           **************************************************************************************************
    182           */

   \                                 In  segment CODE, align 2
    183          uint8 zapSysReq(uint8 cmd, uint8 *req, uint8 *args)
   \                     zapSysReq:
    184          {
   \   000000   3B15         PUSHM.W #0x4, R11
   \   000002   2183         SUB.W   #0x2, SP
   \   000004   484C         MOV.B   R12, R8
   \   000006   0A4D         MOV.W   R13, R10
   \   000008   0B4E         MOV.W   R14, R11
    185            uint8 len, cmd0 = (uint8)MT_RPC_CMD_SREQ;
   \   00000A   7D402000     MOV.B   #0x20, R13
   \   00000E   4E4C         MOV.B   R12, R14
   \   000010   4E83         SUB.B   #0x0, R14
   \   000012   2624         JEQ     ??zapSysReq_6
   \   000014   5E83         SUB.B   #0x1, R14
   \   000016   1424         JEQ     ??zapSysReq_7
   \   000018   5E83         SUB.B   #0x1, R14
   \   00001A   1424         JEQ     ??zapSysReq_8
   \   00001C   7E800600     SUB.B   #0x6, R14
   \   000020   1824         JEQ     ??zapSysReq_9
   \   000022   5E83         SUB.B   #0x1, R14
   \   000024   1224         JEQ     ??zapSysReq_10
   \   000026   5E83         SUB.B   #0x1, R14
   \   000028   1424         JEQ     ??zapSysReq_9
   \   00002A   5E83         SUB.B   #0x1, R14
   \   00002C   1B24         JEQ     ??zapSysReq_2
   \   00002E   5E83         SUB.B   #0x1, R14
   \   000030   0724         JEQ     ??zapSysReq_7
   \   000032   5E83         SUB.B   #0x1, R14
   \   000034   0524         JEQ     ??zapSysReq_7
   \   000036   5E83         SUB.B   #0x1, R14
   \   000038   1824         JEQ     ??zapSysReq_11
   \   00003A   5E83         SUB.B   #0x1, R14
   \   00003C   0D24         JEQ     ??zapSysReq_12
   \   00003E   143C         JMP     ??zapSysReq_13
    186            uint8 *pBuf;
    187          
    188            switch (cmd)
    189            {
    190            // SREQ's to ZNP.
    191          
    192            case MT_SYS_PING:
    193            case MT_SYS_RANDOM:
    194            case MT_SYS_ADC_READ:
    195              len = 2;
   \                     ??zapSysReq_7:
   \   000040   6C43         MOV.B   #0x2, R12
    196              break;
   \   000042   133C         JMP     ??zapSysReq_11
    197          
    198            case MT_SYS_VERSION:
    199              len = sizeof(MTVersionString);
   \                     ??zapSysReq_8:
   \   000044   7C400500     MOV.B   #0x5, R12
    200              break;
   \   000048   103C         JMP     ??zapSysReq_11
    201          
    202            case MT_SYS_SET_EXTADDR:
    203            case MT_SYS_GET_EXTADDR:
    204              len = Z_EXTADDR_LEN;
    205              break;
    206          
    207            case MT_SYS_OSAL_NV_READ:
    208              len = 3;
    209              break;
    210          
    211            case MT_SYS_OSAL_NV_WRITE:
    212              len = args[3] + 4;
   \                     ??zapSysReq_10:
   \   00004A   5C4B0300     MOV.B   0x3(R11), R12
   \   00004E   6C52         ADD.B   #0x4, R12
    213              break;
   \   000050   0C3C         JMP     ??zapSysReq_11
    214          
    215            case MT_SYS_OSAL_START_TIMER:
    216              len = 3;
   \                     ??zapSysReq_9:
   \   000052   7C400300     MOV.B   #0x3, R12
    217              break;
   \   000056   093C         JMP     ??zapSysReq_11
    218          
    219            case MT_SYS_OSAL_STOP_TIMER:
    220              len = 1;
    221              break;
    222              
    223            case MT_SYS_GPIO:
    224              break;
    225          
    226            case MT_SYS_STACK_TUNE:
    227              len = args[1] + 1;
   \                     ??zapSysReq_12:
   \   000058   5C4B0100     MOV.B   0x1(R11), R12
   \   00005C   5C53         ADD.B   #0x1, R12
    228              break;
   \   00005E   053C         JMP     ??zapSysReq_11
    229          
    230            // AREQ's to ZNP.
    231          
    232            case MT_SYS_RESET_REQ:
    233              cmd0 = (uint8)MT_RPC_CMD_AREQ;
   \                     ??zapSysReq_6:
   \   000060   7D404000     MOV.B   #0x40, R13
    234              len = 1;
   \                     ??zapSysReq_2:
   \   000064   5C43         MOV.B   #0x1, R12
    235              break;
   \   000066   013C         JMP     ??zapSysReq_11
    236              
    237            default:
    238              len = 8;  // Biggest return buffer size besides NV access.
   \                     ??zapSysReq_13:
   \   000068   7C42         MOV.B   #0x8, R12
    239              break;
    240            }
    241            cmd0 |= (uint8)MT_RPC_SYS_SYS;
    242          
    243            if (NULL == (pBuf = zap_msg_allocate(len, cmd0, cmd)))
   \                     ??zapSysReq_11:
   \   00006A   4E48         MOV.B   R8, R14
   \   00006C   5DD3         BIS.B   #0x1, R13
   \   00006E   ........     CALLA   #zap_msg_allocate
   \   000072   814C0000     MOV.W   R12, 0(SP)
   \   000076   0C93         CMP.W   #0x0, R12
   \   000078   4124         JEQ     ??zapSysReq_4
    244            {
    245              return FAILURE;
    246            }
    247          
    248            switch (cmd)
   \   00007A   4E48         MOV.B   R8, R14
   \   00007C   4E83         SUB.B   #0x0, R14
   \   00007E   2624         JEQ     ??zapSysReq_14
   \   000080   7E800300     SUB.B   #0x3, R14
   \   000084   0E24         JEQ     ??zapSysReq_15
   \   000086   7E800500     SUB.B   #0x5, R14
   \   00008A   1824         JEQ     ??zapSysReq_16
   \   00008C   5E83         SUB.B   #0x1, R14
   \   00008E   0C24         JEQ     ??zapSysReq_17
   \   000090   5E83         SUB.B   #0x1, R14
   \   000092   1424         JEQ     ??zapSysReq_16
   \   000094   5E83         SUB.B   #0x1, R14
   \   000096   1A24         JEQ     ??zapSysReq_14
   \   000098   6E83         SUB.B   #0x2, R14
   \   00009A   1424         JEQ     ??zapSysReq_18
   \   00009C   6E83         SUB.B   #0x2, R14
   \   00009E   1A24         JEQ     ??zapSysReq_19
   \   0000A0   223C         JMP     ??zapSysReq_20
    249            {
    250            case MT_SYS_SET_EXTADDR:
    251              (void)osal_memcpy(pBuf, req, Z_EXTADDR_LEN);
   \                     ??zapSysReq_15:
   \   0000A2   3E42         MOV.W   #0x8, R14
   \   0000A4   0D4A         MOV.W   R10, R13
   \   0000A6   1D3C         JMP     ??zapSysReq_21
    252              break;
    253          
    254            case MT_SYS_OSAL_NV_WRITE:
    255              (void)osal_memcpy(pBuf+4, req, args[3]);
   \                     ??zapSysReq_17:
   \   0000A8   5E4B0300     MOV.B   0x3(R11), R14
   \   0000AC   0D4A         MOV.W   R10, R13
   \   0000AE   2C52         ADD.W   #0x4, R12
   \   0000B0   ........     CALLA   #osal_memcpy
    256              pBuf[3] = args[3];  // NV Item len.
   \   0000B4   2F41         MOV.W   @SP, R15
   \   0000B6   DF4B03000300 MOV.B   0x3(R11), 0x3(R15)
    257            case MT_SYS_OSAL_NV_READ:
    258            case MT_SYS_OSAL_START_TIMER:
    259              pBuf[2] = args[2];  // NV Item offset / Timer Period MSB.
   \                     ??zapSysReq_16:
   \   0000BC   2F41         MOV.W   @SP, R15
   \   0000BE   DF4B02000200 MOV.B   0x2(R11), 0x2(R15)
    260            case MT_SYS_ADC_READ:
    261              pBuf[1] = args[1];  // NV Item Id MSB / Timer Period LSB / ADC Resolution.
   \                     ??zapSysReq_18:
   \   0000C4   2F41         MOV.W   @SP, R15
   \   0000C6   DF4B01000100 MOV.B   0x1(R11), 0x1(R15)
    262            case MT_SYS_RESET_REQ:
    263            case MT_SYS_OSAL_STOP_TIMER:
    264              pBuf[0] = args[0];  // NV Item Id LSB / Timer Idx / ADC Chan.
   \                     ??zapSysReq_14:
   \   0000CC   2F41         MOV.W   @SP, R15
   \   0000CE   EF4B0000     MOV.B   @R11, 0(R15)
    265              break;
   \   0000D2   093C         JMP     ??zapSysReq_20
    266          
    267            case MT_SYS_GPIO:
    268              break;
    269          
    270            case MT_SYS_STACK_TUNE:
    271              pBuf[0] = args[0];  // The MT_SYS_STACK_TUNE command from STK_Tune_t.
   \                     ??zapSysReq_19:
   \   0000D4   EC4B0000     MOV.B   @R11, 0(R12)
    272              (void)osal_memcpy(pBuf+1, req, args[1]);
   \   0000D8   5E4B0100     MOV.B   0x1(R11), R14
   \   0000DC   0D4A         MOV.W   R10, R13
   \   0000DE   2C41         MOV.W   @SP, R12
   \   0000E0   1C53         ADD.W   #0x1, R12
   \                     ??zapSysReq_21:
   \   0000E2   ........     CALLA   #osal_memcpy
    273              break;
    274              
    275            default:
    276              break;
    277            }
    278          
    279            if (zapPhySend(zapAppPort, pBuf) == FAILURE)
   \                     ??zapSysReq_20:
   \   0000E6   2D41         MOV.W   @SP, R13
   \   0000E8   5C42....     MOV.B   &zapAppPort, R12
   \   0000EC   ........     CALLA   #zapPhySend
   \   0000F0   5C93         CMP.B   #0x1, R12
   \   0000F2   0620         JNE     ??zapSysReq_22
    280            {
    281              zap_msg_deallocate(&pBuf);
   \   0000F4   0C41         MOV.W   SP, R12
   \   0000F6   0C53         ADD.W   #0x0, R12
   \   0000F8   ........     CALLA   #zap_msg_deallocate
    282              return FAILURE;
   \                     ??zapSysReq_4:
   \   0000FC   5C43         MOV.B   #0x1, R12
   \   0000FE   413C         JMP     ??zapSysReq_23
    283            }
    284          
    285            switch (cmd)
   \                     ??zapSysReq_22:
   \   000100   5883         SUB.B   #0x1, R8
   \   000102   1324         JEQ     ??zapSysReq_24
   \   000104   5883         SUB.B   #0x1, R8
   \   000106   1324         JEQ     ??zapSysReq_25
   \   000108   6883         SUB.B   #0x2, R8
   \   00010A   1824         JEQ     ??zapSysReq_26
   \   00010C   6882         SUB.B   #0x4, R8
   \   00010E   1924         JEQ     ??zapSysReq_27
   \   000110   5883         SUB.B   #0x1, R8
   \   000112   1024         JEQ     ??zapSysReq_28
   \   000114   5883         SUB.B   #0x1, R8
   \   000116   0E24         JEQ     ??zapSysReq_28
   \   000118   5883         SUB.B   #0x1, R8
   \   00011A   0C24         JEQ     ??zapSysReq_28
   \   00011C   5883         SUB.B   #0x1, R8
   \   00011E   0524         JEQ     ??zapSysReq_24
   \   000120   5883         SUB.B   #0x1, R8
   \   000122   0324         JEQ     ??zapSysReq_24
   \   000124   6883         SUB.B   #0x2, R8
   \   000126   2524         JEQ     ??zapSysReq_29
   \   000128   273C         JMP     ??zapSysReq_30
    286            {
    287            // SREQ's to ZNP.
    288          
    289            case MT_SYS_PING:
    290            case MT_SYS_RANDOM:
    291            case MT_SYS_ADC_READ:
    292              (void)osal_memcpy(req, pBuf, 2);
   \                     ??zapSysReq_24:
   \   00012A   2E43         MOV.W   #0x2, R14
   \   00012C   083C         JMP     ??zapSysReq_5
    293              break;
    294          
    295            case MT_SYS_VERSION:
    296              (void)osal_memcpy(req, pBuf, sizeof(MTVersionString));
   \                     ??zapSysReq_25:
   \   00012E   3E400500     MOV.W   #0x5, R14
   \   000132   053C         JMP     ??zapSysReq_5
    297              break;
    298              
    299            case MT_SYS_SET_EXTADDR:
    300              // It is not intuitive to have non-NULL args just for return value that should always be TRUE.
    301              break;
    302          
    303            case MT_SYS_OSAL_NV_WRITE:
    304            case MT_SYS_OSAL_START_TIMER:
    305            case MT_SYS_OSAL_STOP_TIMER:
    306              args[0] = pBuf[0];
   \                     ??zapSysReq_28:
   \   000134   2F41         MOV.W   @SP, R15
   \   000136   EB4F0000     MOV.B   @R15, 0(R11)
    307              break;
   \   00013A   1E3C         JMP     ??zapSysReq_30
    308          
    309            case MT_SYS_GET_EXTADDR:
    310              (void)osal_memcpy(req, pBuf, Z_EXTADDR_LEN);
   \                     ??zapSysReq_26:
   \   00013C   3E42         MOV.W   #0x8, R14
   \                     ??zapSysReq_5:
   \   00013E   2D41         MOV.W   @SP, R13
   \   000140   103C         JMP     ??zapSysReq_0
    311              break;
    312          
    313            case MT_SYS_OSAL_NV_READ:
    314              if ((SUCCESS == (args[0] = pBuf[0])) && (args[3] == (args[1] = pBuf[1])))
   \                     ??zapSysReq_27:
   \   000142   2F41         MOV.W   @SP, R15
   \   000144   6E4F         MOV.B   @R15, R14
   \   000146   CB4E0000     MOV.B   R14, 0(R11)
   \   00014A   4E93         CMP.B   #0x0, R14
   \   00014C   0E20         JNE     ??zapSysReq_31
   \   00014E   2F41         MOV.W   @SP, R15
   \   000150   5E4F0100     MOV.B   0x1(R15), R14
   \   000154   CB4E0100     MOV.B   R14, 0x1(R11)
   \   000158   CB9E0300     CMP.B   R14, 0x3(R11)
   \   00015C   0620         JNE     ??zapSysReq_31
    315              {
    316                (void)osal_memcpy(req, pBuf+2, args[1]);
   \   00015E   2D41         MOV.W   @SP, R13
   \   000160   2D53         ADD.W   #0x2, R13
   \                     ??zapSysReq_0:
   \   000162   0C4A         MOV.W   R10, R12
   \   000164   ........     CALLA   #osal_memcpy
   \   000168   073C         JMP     ??zapSysReq_30
    317              }
    318              else
    319              {
    320                args[0] = NV_OPER_FAILED;
   \                     ??zapSysReq_31:
   \   00016A   FB400A000000 MOV.B   #0xa, 0(R11)
   \   000170   033C         JMP     ??zapSysReq_30
    321              }
    322              break;
    323          
    324            case MT_SYS_GPIO:
    325              break;
    326          
    327            case MT_SYS_STACK_TUNE:
    328              *req = *pBuf;
   \                     ??zapSysReq_29:
   \   000172   2F41         MOV.W   @SP, R15
   \   000174   EA4F0000     MOV.B   @R15, 0(R10)
    329              break;
    330              
    331            default:
    332              break;
    333            }
    334          
    335            zap_msg_deallocate(&pBuf);
   \                     ??zapSysReq_30:
   \   000178   0C41         MOV.W   SP, R12
   \   00017A   0C53         ADD.W   #0x0, R12
   \   00017C   ........     CALLA   #zap_msg_deallocate
    336            return SUCCESS;
   \   000180   4C43         MOV.B   #0x0, R12
   \                     ??zapSysReq_23:
   \   000182   2153         ADD.W   #0x2, SP
   \   000184   3817         POPM.W  #0x4, R11
   \   000186   1001         RETA
    337          }
    338          
    339          /**************************************************************************************************
    340           * @fn          zapSysResetInd
    341           *
    342           * @brief       This function processes the SYS sub-system MT_SYS_RESET_IND response.
    343           *
    344           * input parameters
    345           *
    346           * @param       port - Port Id corresponding to the ZNP that sent the message.
    347           * @param       pBuf - A pointer to the RPC response.
    348           *
    349           * output parameters
    350           *
    351           * None.
    352           *
    353           * @return      None.
    354           **************************************************************************************************
    355           */
    356          static void zapSysResetInd(uint8 port, uint8 *pBuf)
    357          {
    358            //pBuf[0] = ResetReason();   /* Reason */
    359            //pBuf[1] = 0x00;            /* Transport Revision */
    360            //pBuf[2] = 0x00;            /* Product */
    361            //pBuf[3] = 0x00;            /* Major Revision */
    362            //pBuf[4] = 0x00;            /* Minor Revision */
    363            //pBuf[5] = 0x00;            /* Hardware Revision */
    364            (void)pBuf;
    365            zapGotSync(port);
    366          }
    367          
    368          #endif
    369          /**************************************************************************************************
    370          */

   Maximum stack usage in bytes:

   CSTACK Function
   ------ --------
       4  zapSysProcessIncoming
             4 -> zapGotSync
      14  zapSysReq
            14 -> osal_memcpy
            14 -> zapPhySend
            14 -> zap_msg_allocate
            14 -> zap_msg_deallocate
       8  zapSysStackTune
             8 -> zapSysReq


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      14  zapSysProcessIncoming
     392  zapSysReq
      44  zapSysStackTune

 
 450 bytes in segment CODE
 
 450 bytes of CODE memory

Errors: none
Warnings: none
